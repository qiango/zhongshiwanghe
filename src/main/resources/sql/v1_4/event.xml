<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hongzhi.zswh.app_1_4.dao.EventDao">



    <select id="statusInfo" resultType="map" >
    select
         case when user_id = #{userID}
              then 'true'
              else 'false'
              end as is_registered
        ,count(1) as registered_count
    from event_registration
    where event_id = #{eventID}
    </select>

    <select id="events" resultType="com.hongzhi.zswh.app_1_4.entity.Event">
        select
             a.event_id
            ,a.club_id
            ,a.end_time
            ,a.event_address
            ,a.event_name
            ,a.event_status
            ,a.fee
            ,a.form_item
            ,a.image
            ,a.max_people
            ,a.min_people
            ,a.organizer_id
            ,a.register_end_time
            ,a.register_start_time
            ,a.start_time
            ,a.view_guests
        from
            event a
        where
        <if test=" event_id !=null  and   event_id !='' ">
            a.event_id = #{event_id}
        and
        </if>
        <if test="club_id !=null  and   club_id !='' ">
            a.club_id = #{club_id}
        and
        </if>
            a.event_status = 1
        or
          (a.event_status = 2 and a.end_time > now())

    </select>
</mapper>