<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hongzhi.zswh.app_v6.dao.V6ClubDao">


    <update id="saveClubPic">
        update club a
        set
          a.club_pic = #{picUrl}
        where a.club_id = #{club_id}
          and a.is_delete = 0
    </update>


    <!--List<Map<String,Objects>> selectCompetitionByUserId(Integer userId);-->
    <select id="selectCompetitionByUserId" resultType="map">
        SELECT
          b.competition_id
        FROM
          user_competition a
        LEFT JOIN
          competition b
        on a.competition_id =b.competition_id
        WHERE a.user_id = #{userId} and b.compertition_live_status =3
    </select>
    <!--UserDetailEntity selectUserDetailEntity(Integer userId);-->
    <select id="selectUserDetailEntity" resultType="com.hongzhi.zswh.app_v6.entity.UserDetailEntity">
        SELECT
          club_id,
          user_id,
          jump_club_number,
          join_club_status,
          user_level,
          create_time,
          change_status_time,
          club_refuse_id
        FROM user_detail  where user_id=#{userId};
    </select>
    <!--void insetIntoUserDetail();-->
    <insert id="insetIntoUserDetail" parameterType="com.hongzhi.zswh.app_v6.entity.UserDetailEntity">
        INSERT INTO user_detail_bak(
          `club_id`,`user_id`,
          `jump_club_number`,
          `join_club_status`,
          `user_level`,
          `create_time`,
          `change_status_time`,
          `club_refuse_id`,
          `create_time_bak`
        ) VALUE(
          #{club_id},
          #{user_id},
          #{jump_club_number},
          #{join_club_status},
          #{user_level},
          #{create_time},
          #{change_status_time},
          #{club_refuse_id},
          NOW()
        )
    </insert>
    <!--void deleteUserDetailByUserId(@Param("userId") Integer userId);-->
    <delete id="deleteUserDetailByUserId">
        DELETE FROM user_detail WHERE user_id =#{userId}
    </delete>
    <select id="selectClubAdmin" resultType="map">
       select user_level
       from user_detail
       where
          club_id = #{club_id}
          and
          user_id = #{user_id}
          and user_level=0

    </select>

    <update id="transferClubByUserId">
        update user_detail a
        set
          a.user_level = #{user_level}
        where a.club_id = #{club_id}
          and a.user_id = #{id}
    </update>

    <select id="listClubByPageCount" resultType="Integer" >
        select
         count(*) as data_count
        from club  a
        left join world_city b
          on a.id = b.id
        left join dictionary  c
          on a.language_id = c.code
          and c.p_code='language'
          and c.language= #{language}
        left join dictionary d
          on a.club_status = d.code
          and d.p_code = 'club'
          and d.language= #{language}
        where is_delete = '0'
        <if test=" other !=null ">
            and  a.club_name  like  CONCAT('%', #{other} ,'%')
        </if>
    </select>

    <select id="listClubByPage" resultType="map" >
        select
          a.club_id
          ,a.club_name
          ,d.value   as club_status
        from club  a
        left join world_city b
          on a.id = b.id
        left join dictionary  c
          on a.language_id = c.code
          and c.p_code='language'
          and c.language= #{language}
        left join dictionary d
          on a.club_status = d.code
          and d.p_code = 'club'
          and d.language= #{language}
        where is_delete = '0'
        <if test=" other !=null ">
            and  a.club_name  like  CONCAT('%', #{other} ,'%')
        </if>
        <if test=" pageStartRow !=null  and   pageRecorders != null ">
            limit  #{pageStartRow } , #{pageRecorders }
        </if>
    </select>
</mapper>