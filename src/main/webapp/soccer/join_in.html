<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <title>5人足球赛</title>
    <link rel="stylesheet" href="http://apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://cdn.bootcss.com/animate.css/3.5.2/animate.css">
    <style>
      html{ height: 100%; position: relative; }
      body{ height: 100%; background: url(images/bg_repeat.png) repeat; font-weight: 400; font-size: 13px; -webkit-font-smoothing:antialiased; overflow-x: hidden; font-family: 'Microsoft Yahei'; }
      button{ border: 0; outline: 0 !important; }
      .content{ margin: 0 10px; padding: 10px 0; }
      .vote-title{ background: url(images/vote_title.png) no-repeat; padding: 13px 13px 13px 32px; background-size: contain; background-position: center; }
      .back-btn{ width: 25px; height: 25px; position: fixed; top: 35px; left: 20px; background:url(images/back_btn.png) no-repeat; background-size: 100% 100%; }
      .search-btn{ width: 25px; height: 25px; position: fixed; top: 35px; right: 20px; color: #fff; font-size: 20px; padding: 2px; }

      .submit-btn{ background: url(images/button.png) no-repeat; background-size: 100% 100%; font-size: 16px; padding: 8px 25px; font-weight: 600; vertical-align: middle; }
      .loop-animate{ -webkit-animation-direction: alternate; animation-direction: alternate; }
      .color-yellow{ color: #ffe221; font-weight: 500; }
      .color-green{ color: #175917; }
      .color-white{ color: #fff; line-height: 1.8; }
      .color-ddd{ color: #ddd; line-height: 1.8; }
      .h-100p{ height: 100%; }
      .m-0{ margin: 0 !important; }
      .m-3{ margin: 3px; }
      .mt-17{ margin-top: 17px; }
      .mt-20{ margin-top: 20px !important; }
      .mt-30{ margin-top: 30px; }
      .mb-15{ margin-bottom: 15px; }
      .mb-12{ margin-bottom: 12px; }
      .mb-20{ margin-bottom: 20px; }
      .mb-25{ margin-bottom: 25px; }
      .f-600{ font-weight: 600; }
      .font-12{ font-size: 12px; }
      .font-16{ font-size: 16px; }
      .font-18{ font-size: 18px; }
      .font-20{ font-size: 20px; }
      .pl-24{ padding-left: 24px; }
      .pl-10{ padding-left: 10px; }
      .px-5{ padding-left: 5px; padding-right: 5px; }
      .footer{ position: absolute; bottom: 12px; font-size: 12px; width: 100%; }
      .w-21p{ width: 21%; }
      .rect{ padding-bottom: 100%; position: relative; }
      .rect > img{ width: 100%; height: 100%; position: absolute; border-radius: 50%; background-color: transparent; }
      .text-ellipsis{ overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

      .justify-layout{ text-align: justify; line-height: 0; }
      .justify-layout:after{ content: ""; display: inline-block; width: 100%; height: 0; overflow: hidden; clear: both; }
      .justify-item{ display: inline-block; float: none; vertical-align: top; }
      .item.justify-layout{ overflow-x: hidden; overflow-y: auto; }
      .player-container{ height: -webkit-calc(100% - 126px); height: calc(100% - 126px); }
      .carousel-indicators-fix{ position: fixed; bottom: 46px; margin-bottom: 0; }
      .player-position + .f-600{ display: none; background: -webkit-linear-gradient(#6b9f3d, #408426); background: linear-gradient(#6b9f3d, #408426); vertical-align: middle; }
      .player-position{ font-size: 10px; }
      .justify-item.selected .rect{ background: url(images/selected.png) no-repeat; background-size: contain; }
      .justify-item.selected .player-position{ display: none; }
      .justify-item.selected .player-position + .f-600{ display: inline-block; width: 100%; font-size: 10px; }
      .modal-back{ height: 0; overflow: hidden; position: absolute; }
      .modal-back.load{ width: 100%; height: 100%; background-color: rgba(111,111,111,0.6); left: 0; top: 0; z-index: 100; }
      .back-text{ position: absolute; width: 100%; top: 50%; margin-top: -.5em; color: #fff; font-size: 16px; text-align: center; } 
      
      .panel-group{ position: absolute; z-index: 22; height: 100%; width: 100%; -webkit-transition: -webkit-transform .4s ease-out 0s; -webkit-transform: translateZ(0) perspective(1000px) rotateY(-90deg); -webkit-transform-origin: 100% 50%;
       transition: transform .4s ease-out 0s; transform: translateZ(0) perspective(1000px) rotateY(-90deg); transform-origin: 100% 50%; }
      .panel-group.active{ -webkit-transform: translateZ(0); transform: translateZ(0); }
      .search-panel{ position: absolute; height: 100%; width: 100%; }
      .blur{ -webkit-filter: blur(3px); }
      .bg-alpha{ background: -webkit-linear-gradient(rgba(12, 12, 12, 0.5), rgba(32,178,170,0.5), rgba(146, 212, 105, 0.5) , rgba(32, 178, 170, 0.5)); background: linear-gradient(rgba(12, 12, 12, 0.5), rgba(32,178,170,0.5), rgba(146, 212, 105, 0.5) , rgba(32, 178, 170, 0.5)); }
      .table{ display: table !important; padding: 10px 15px; width: 100%; float: none !important; }
      .table-cell{ display: table-cell !important; }
      .navbar-form .form-group { display: table-cell !important; margin-bottom: 0; vertical-align: middle; padding-right: 5px; }
      .navbar-form .form-group .form-control { width: 100%; }
      .cancel-search{ font-size: 32px; vertical-align: middle; display: table-cell; padding-right: 10px; color: #fff; }
      .bg-help{ background-color: rgba(111,111,111,.8);; }
      .matched-item{ height: -webkit-calc(100% - 56px); height: calc(100% - 56px); background-color: rgba(111,111,111,.8); }
    </style> 
  </head>
  <body class="clearfix">
    <div class="panel-group">
      <div class="search-panel bg-alpha">
        <form class="navbar-form navbar-left text-center m-0 table bg-help" id="search-form" role="search">
          <i class="fa fa-angle-right cancel-search"></i>
          <div class="form-group">
            <input type="text" class="form-control" id="search-keys" placeholder="请输入搜索关键字">
          </div>
          <button type="submit" class="btn btn-default table-cell btn-block" id="btn-filter">搜索</button>
        </form>
        <div class="panel-body matched-item">
          <div class="item active justify-layout h-100p">
            

          </div>      
        </div>
      </div>
    </div>

    <div class="content clearfix h-100p">
      <button type="button" class="back-btn pulse animated infinite loop-animate" onclick="history.back();"></button>
      <i class="fa fa-search search-btn"></i>
      <h3 class="color-green f-600 text-center font-16 mt-17"><div class="vote-title">最佳人气球员投票</div></h3>
      <div class="player-container">
        <div id="carousel-ad" class="carousel slide h-100p px-5" >
          <ol class="carousel-indicators carousel-indicators-fix">
            <li data-target="#carousel-ad" data-slide-to="0" class="active"></li>
            <li data-target="#carousel-ad" data-slide-to="1"></li>
            <li data-target="#carousel-ad" data-slide-to="2"></li>
            <li data-target="#carousel-ad" data-slide-to="3"></li>
          </ol>
          <div class="carousel-inner h-100p">

            <div class="item active justify-layout h-100p">
              <div class="justify-item w-21p mb-12 selected" data-value="1">
                <div class="rect">
                  <img src="" alt="" data-src="images/button.png">
                </div>
                <h5 class="text-center font-12 m-3 color-white f-600">罗纳尔多</h5>
                <div class="font-12 color-ddd text-ellipsis text-center player-position">上海申花队守门员</div>
                <div class="font-12 color-ddd text-ellipsis text-center f-600">选择TA</div>
                <div class="font-12 color-ddd text-ellipsis text-center">123123票</div>
              </div>              
            </div>

            <div class="item justify-layout">              
              <div class="justify-item w-21p mb-12" data-value="2">
                <div class="rect">
                  <img src="" alt="" data-src="images/bg_repeat.png">
                </div>
                <h5 class="text-center font-12 m-3 color-white f-600">罗纳尔多</h5>
                <div class="font-12 color-ddd text-ellipsis text-center player-position">上海申花队守门员</div>
                <div class="font-12 color-ddd text-ellipsis text-center f-600">选择TA</div>
                <div class="font-12 color-ddd text-ellipsis text-center">123123票</div>
              </div>
            </div>

            <div class="item justify-layout">              
              <div class="justify-item w-21p mb-12" data-value="4">
                <div class="rect">
                  <img src="" alt="" data-src="images/vote_title.png">
                </div>
                <h5 class="text-center font-12 m-3 color-white f-600">罗纳尔多</h5>
                <div class="font-12 color-ddd text-ellipsis text-center player-position">上海申花队守门员</div>
                <div class="font-12 color-ddd text-ellipsis text-center f-600">选择TA</div>
                <div class="font-12 color-ddd text-ellipsis text-center">123123票</div>
              </div>
            </div>

            <div class="item justify-layout">              
              <div class="justify-item w-21p mb-12" data-value="8">
                <div class="rect">
                  <img src="" alt="" data-src="images/back_btn.png">
                </div>
                <h5 class="text-center font-12 m-3 color-white f-600">罗纳尔多</h5>
                <div class="font-12 color-ddd text-ellipsis text-center player-position">上海申花队守门员</div>
                <div class="font-12 color-ddd text-ellipsis text-center f-600">选择TA</div>
                <div class="font-12 color-ddd text-ellipsis text-center">123123票</div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- 提交球员 -->
      <form class="clearfix mt-20" id="submit-form" action="">
        <input type="hidden" name="player_id" data-submit value>
        <button type="submit" class="submit-btn text-center col-xs-6 col-xs-offset-3">投票</button>
      </form>
    </div>

    <!-- 遮罩 -->
    <div class="modal-back">
      <div class="back-text">
      <i class="fa fa-spinner fa-spin"></i>
        &nbsp;处理中，请稍候...
      </div>
    </div>
    <script type="text/javascript" src="http://apps.bdimg.com/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://touch.code.baidu.com/touch-0.2.14.min.js"></script>
    <script type="text/javascript">
    if(location.search.search('session_id=') === -1){
      alert('你未登录，你可以登录之后再进行相关操作');
      history.back();
    } else {
      [].forEach.call(document.querySelectorAll('.choose-link'),function(v,k){
        v.href = v.href + location.search;
      });
    }
    //高度的问题
    $('html').css('height',$(window).height());

    //滑动屏幕切换
    touch.on('.carousel-inner','swipe',function(e){
      if(e.direction == 'left'){
        if($('[data-target="#carousel-ad"].active').next().length){
          $('[data-target="#carousel-ad"].active').next().click();
        } else {
          $('[data-target="#carousel-ad"]').eq(0).click();
        }
      } else if(e.direction == 'right') {
        if($('[data-target="#carousel-ad"].active').prev().length){
          $('[data-target="#carousel-ad"].active').prev().click();
        } else {
          $('[data-target="#carousel-ad"]').eq(-1).click();
        }
      }
    });

    //选择球员
    $(document).on('click','.justify-item',function(){
      if(!$(this).hasClass('selected')){
        $('.justify-item.selected').removeClass('selected');
        $('[data-submit]').val($(this).addClass('selected').attr('data-value'));
      } else {
        $('.justify-item.selected').removeClass('selected');
        $('[data-submit]').val('');
      }
    });
    $('.justify-item.selected').find('img[data-src]').each(function(){
      this.src = $(this).attr('data-src');
      this.removeAttribute('data-src');
    });
    $('[data-submit]').val($('.justify-item.selected').addClass('selected').attr('data-value'));
    //图片延迟加载
    $('.carousel-indicators-fix').on('click','[data-target="#carousel-ad"]',function(){
      setTimeout(function(){
        $('.item.justify-layout.next').find('img[data-src]').each(function(){
          this.src = $(this).attr('data-src');
          this.removeAttribute('data-src');
        });
      });
    });

    //表单提交
    $('#submit-form').submit(function(){
      if(!$('[data-submit]').val()){
        alert('选择球员之后才能提交哦！');
        return false;
      }
      $.ajax({
        type: 'POST',
        url: '',
        data: $(this).serialize(),
      })
      .done(function(){
        alert('提交成功，感谢您的参与！');
      })
      .fail(function(){
        alert('请求出错，请稍后重试！');
        location.reload();
      });
      return false;
    });

    //过渡
    $(document)
      .ajaxStart(function(){
        $('.modal-back').addClass('load');
      })
      .ajaxStop(function(){
        $('.modal-back').removeClass('load');
      });

    //搜索与取消搜索
    var 
      panelGroup = $('.panel-group'),
      content = $('.content');
    
    //弹出搜索框
    var matchItem = $('.matched-item').find('.justify-layout');
    $('.search-btn').click(function(){
      panelGroup.addClass('active');
      //content.addClass('blur');
      $('body').find('img[data-src]').each(function(){
        this.src = $(this).attr('data-src');
        this.removeAttribute('data-src');
      });
      $('.justify-item.selected').click();
    });
    //隐藏搜索框
    $('.cancel-search').click(function(){
      panelGroup.removeClass('active');
      //content.removeClass('blur');
      setTimeout(function(){
        matchItem.empty();
      }, 450);
    });
    //过滤
    $('#search-form').submit(function(){
      var keys = $('#search-keys').val();
      var nodes = '';
      if(keys === '0' || keys){

        nodes = $('#carousel-ad').find('.justify-item:contains('+ keys +')').clone().toArray();
        if(!nodes.length){
          matchItem.html('<h5 class="text-center color-white mt-20">未搜索到匹配的运动员！</h5>');
          return false;
        }
        for(var j =1 ;j < nodes.length; j = j+2){
          nodes.splice(j,0,'&nbsp;')
        }
        matchItem.html(nodes);
      } else {
        matchItem.html('<h5 class="text-center color-white mt-20">未搜索到匹配的运动员！</h5>');
      }
      return false
    });
    //选中之后隐藏搜索框
    matchItem.on('click','.justify-item',function(){
      var _this = this;
      $('.cancel-search').click();
      var target = $('#carousel-ad').find('.justify-item[data-value="'+ _this.getAttribute('data-value') +'"]');
      setTimeout(function(){
        target.click();
      });
      document.querySelectorAll('[data-slide-to]')[$('#carousel-ad').find('.justify-layout').index(target[0].parentNode)].click();
    });
    </script>
  </body>
</html>
